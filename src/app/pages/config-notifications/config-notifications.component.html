<div class="page config-notifications">
  <div class="header">
    <div class="title">
      <h2>‚öôÔ∏è C·∫•u h√¨nh th√¥ng b√°o</h2>
      <div class="subtitle">Qu·∫£n l√Ω c·∫•u h√¨nh g·ª≠i th√¥ng b√°o, l·ªãch s·ª≠ v√† k√≠ch ho·∫°t</div>
    </div>
    <div class="header-actions">
      <button class="btn" (click)="openList()">üìñ Xem l·ªãch s·ª≠</button>
      <button class="btn success" (click)="startEdit()">‚ûï T·∫°o c·∫•u h√¨nh m·ªõi</button>
    </div>
  </div>

  <div class="cards">
    <div class="card active-card" *ngIf="active">
      <div class="card-head">
        <h3>üìå ƒêang s·ª≠ d·ª•ng</h3>
        <div class="badge">Active</div>
      </div>
      <div class="card-body">
        <div class="row"><span class="label">S·ªë ng√†y th√¥ng b√°o (th·ª≠ vi·ªác):</span> <span class="value">{{ active.soNgayThongBao }}</span></div>
        <div class="row"><span class="label">Danh s√°ch nƒÉm th√¥ng b√°o:</span> <span class="value">{{ active.danhSachNamThongBao }}</span></div>
        <div class="row"><span class="label">L√†m vi·ªác th·ª© B·∫£y:</span> <span class="value">{{ active.excludeSaturday ? 'Kh√¥ng' : 'C√≥' }}</span></div>
        <div class="row"><span class="label">L√†m vi·ªác Ch·ªß Nh·∫≠t:</span> <span class="value">{{ active.excludeSunday ? 'Kh√¥ng' : 'C√≥' }}</span></div>
      </div>
      <div class="card-actions">
        <button class="btn" (click)="openList()">üìñ L·ªãch s·ª≠</button>
        <button class="btn primary" (click)="startEdit(active)">‚úèÔ∏è S·ª≠a</button>
      </div>
    </div>

    <div *ngIf="active === null" class="card empty-card">
      <div class="empty">
        <div class="empty-title">Ch∆∞a c√≥ c·∫•u h√¨nh</div>
        <div class="empty-sub">Hi·ªán ch∆∞a c√≥ c·∫•u h√¨nh th√¥ng b√°o n√†o ƒëang ƒë∆∞·ª£c s·ª≠ d·ª•ng.</div>
        <div class="empty-actions">
          <button class="btn success" (click)="startEdit()">‚ûï T·∫°o c·∫•u h√¨nh m·ªõi</button>
          <button class="btn" (click)="openList()">üìñ Xem l·ªãch s·ª≠</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Editor Modal -->
  <div class="modal-backdrop" *ngIf="editing">
    <div class="modal card" data-type="editor">
      <div class="modal-head">
        <h3>{{ editing.id ? '‚úèÔ∏è S·ª≠a c·∫•u h√¨nh #' + (editing.id || '') : '‚ûï T·∫°o c·∫•u h√¨nh m·ªõi' }}</h3>
        <button class="close" (click)="cancelEdit()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="editor-grid">
          <div class="field">
            <label>S·ªë ng√†y th√¥ng b√°o (th·ª≠ vi·ªác)</label>
            <input class="input" type="number" [(ngModel)]="editing.soNgayThongBao" />
            <div *ngIf="editorErrors['soNgayThongBao']" class="field-error">{{ editorErrors['soNgayThongBao'] }}</div>
          </div>
          <div class="field">
            <label>Danh s√°ch nƒÉm (CSV, v√≠ d·ª•: 1,2,3)</label>
            <input class="input" [(ngModel)]="editing.danhSachNamThongBao" placeholder="v√≠ d·ª•: 1,2,3" />
            <div *ngIf="editorErrors['danhSachNamThongBao']" class="field-error">{{ editorErrors['danhSachNamThongBao'] }}</div>
          </div>
          <div class="field">
            <label><input type="checkbox" [(ngModel)]="editing.excludeSaturday" /> Lo·∫°i tr·ª´ th·ª© B·∫£y</label>
          </div>
          <div class="field">
            <label><input type="checkbox" [(ngModel)]="editing.excludeSunday" /> Lo·∫°i tr·ª´ Ch·ªß Nh·∫≠t</label>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn success" (click)="save()">üíæ L∆∞u</button>
        <button class="btn" (click)="cancelEdit()">‚ùå H·ªßy</button>
        <button *ngIf="editing.id" class="btn danger" (click)="requestDelete(editing.id)">üóëÔ∏è X√≥a</button>
      </div>
    </div>
  </div>

  <!-- List Modal -->
  <div class="modal-backdrop" *ngIf="listOpen">
    <div class="modal card" data-type="list">
      <div class="modal-head">
        <h3>üìñ Danh s√°ch c·∫•u h√¨nh</h3>
        <button class="close" (click)="listOpen = false">√ó</button>
      </div>
      <div class="modal-body">
        <table class="small">
          <thead>
            <tr>
              <th>S·ªë ng√†y</th>
              <th>Danh s√°ch nƒÉm</th>
              <th>Th·ª© B·∫£y</th>
              <th>Ch·ªß Nh·∫≠t</th>
              <th>Tr·∫°ng th√°i</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let c of all">
              <td data-label="S·ªë ng√†y">{{ c.soNgayThongBao }}</td>
              <td data-label="Danh s√°ch nƒÉm">{{ c.danhSachNamThongBao }}</td>
              <td data-label="Th·ª© B·∫£y">{{ c.excludeSaturday ? 'Lo·∫°i tr·ª´' : 'Bao g·ªìm' }}</td>
              <td data-label="Ch·ªß Nh·∫≠t">{{ c.excludeSunday ? 'Lo·∫°i tr·ª´' : 'Bao g·ªìm' }}</td>
              <td data-label="Tr·∫°ng th√°i">
                <span class="badge" [class.active]="c.isActive">{{ c.isActive ? 'ƒêang d√πng' : '‚Äî' }}</span>
              </td>
              <td class="row-actions">
                <button class="btn small primary" (click)="startEdit(c)">S·ª≠a</button>
                <button class="btn small success" (click)="activate(c.id)">K√≠ch ho·∫°t</button>
                <button *ngIf="c.id" class="btn small danger" (click)="requestDelete(c.id)">X√≥a</button>
              </td>
            </tr>
            <tr *ngIf="all.length === 0">
              <td colspan="6" class="no-data">Kh√¥ng c√≥ d·ªØ li·ªáu</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-actions">
        <button class="btn" (click)="listOpen = false">ƒê√≥ng</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-backdrop" *ngIf="confirmDeleteId">
    <div class="modal card" data-type="delete">
      <div class="modal-head">
        <h3>‚ö†Ô∏è X√°c nh·∫≠n x√≥a</h3>
        <button class="close" (click)="cancelDelete()">√ó</button>
      </div>
      <div class="modal-body">
        <p>B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a c·∫•u h√¨nh #{{ confirmDeleteId }}? H√†nh ƒë·ªông <strong>kh√¥ng th·ªÉ ho√†n t√°c</strong>.</p>
      </div>
      <div class="modal-actions">
        <button class="btn" (click)="cancelDelete()">H·ªßy</button>
        <button class="btn danger" (click)="confirmDelete()">X√≥a</button>
      </div>
    </div>
  </div>
</div>