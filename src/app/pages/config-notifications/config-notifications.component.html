<div class="page config-notifications">
  <div class="header">
    <div class="title">
      <h2>‚öôÔ∏è C·∫•u h√¨nh th√¥ng b√°o</h2>
      <div class="subtitle">Qu·∫£n l√Ω c·∫•u h√¨nh g·ª≠i th√¥ng b√°o, l·ªãch s·ª≠ v√† k√≠ch ho·∫°t</div>
    </div>
    <div class="header-actions">
      <button class="btn" (click)="openList()">üìñ Xem l·ªãch s·ª≠</button>
      <button class="btn success" (click)="startEdit()">‚ûï T·∫°o c·∫•u h√¨nh m·ªõi</button>
    </div>
  </div>

  <div class="cards">
    <div class="card active-card" *ngIf="active">
      <div class="card-head">
        <h3>üìå ƒêang s·ª≠ d·ª•ng</h3>
        <div class="badge">Active</div>
      </div>
      <div class="card-body">
        <div class="config-grid">
          <div class="config-item solo">
            <div class="config-label">S·ªë ng√†y th√¥ng b√°o (th·ª≠ vi·ªác)</div>
            <div class="config-value">{{ active.soNgayThongBao }} ng√†y</div>
          </div>
          <div class="config-section">
            <div class="section-title">üìÖ Th√¥ng b√°o theo nƒÉm</div>
            <div class="section-content">
              <div class="config-row">
                <div class="config-label">Th√¥ng b√°o tr∆∞·ªõc</div>
                <div class="config-value">{{ active.soNgayThongBaoTruoc }} ng√†y</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="card-actions">
        <button class="btn" (click)="openList()">üìñ L·ªãch s·ª≠</button>
        <button class="btn primary" (click)="startEdit(active)">‚úèÔ∏è S·ª≠a</button>
      </div>
    </div>

    <div *ngIf="active === null" class="card empty-card">
      <div class="empty">
        <div class="empty-title">Ch∆∞a c√≥ c·∫•u h√¨nh</div>
        <div class="empty-sub">Hi·ªán ch∆∞a c√≥ c·∫•u h√¨nh th√¥ng b√°o n√†o ƒëang ƒë∆∞·ª£c s·ª≠ d·ª•ng.</div>
        <div class="empty-actions">
          <button class="btn success" (click)="startEdit()">‚ûï T·∫°o c·∫•u h√¨nh m·ªõi</button>
          <button class="btn" (click)="openList()">üìñ Xem l·ªãch s·ª≠</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Editor Modal -->
  <div class="modal-backdrop" *ngIf="editing">
    <div class="modal card" data-type="editor">
      <div class="modal-head">
        <h3>{{ editing.id ? '‚úèÔ∏è S·ª≠a c·∫•u h√¨nh #' + (editing.id || '') : '‚ûï T·∫°o c·∫•u h√¨nh m·ªõi' }}</h3>
        <button class="close" (click)="cancelEdit()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="editor-grid">
          <!-- Th√¥ng b√°o th·ª≠ vi·ªác -->
          <div class="field-section">
            <div class="section-header">
              <h4>üë§ Th√¥ng b√°o th·ª≠ vi·ªác</h4>
            </div>
            <div class="field">
              <label>S·ªë ng√†y th√¥ng b√°o</label>
              <div class="input-with-unit">
                <input class="input" type="number" [(ngModel)]="editing.soNgayThongBao" min="0" />
                <span class="unit">ng√†y</span>
              </div>
              <div *ngIf="editorErrors['soNgayThongBao']" class="field-error">{{ editorErrors['soNgayThongBao'] }}</div>
            </div>
          </div>

          <!-- Th√¥ng b√°o theo nƒÉm -->
          <div class="field-section">
            <div class="section-header">
              <h4>üìÖ Th√¥ng b√°o theo nƒÉm</h4>
              <div class="section-desc">C·∫•u h√¨nh th√¥ng b√°o cho c√°c m·ªëc nƒÉm l√†m vi·ªác (1-20 nƒÉm)</div>
            </div>
            <div class="field">
              <label>Th√¥ng b√°o tr∆∞·ªõc</label>
              <div class="input-with-unit">
                <input class="input" type="number" [(ngModel)]="editing.soNgayThongBaoTruoc" min="0" />
                <span class="unit">ng√†y</span>
              </div>
              <div class="field-help">Th√¥ng b√°o tr∆∞·ªõc bao nhi√™u ng√†y khi ƒë·∫øn m·ªëc nƒÉm</div>
              <div *ngIf="editorErrors['soNgayThongBaoTruoc']" class="field-error">{{ editorErrors['soNgayThongBaoTruoc'] }}</div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn success" (click)="save()">üíæ L∆∞u</button>
        <button class="btn" (click)="cancelEdit()">‚ùå H·ªßy</button>
        <button *ngIf="editing.id" class="btn danger" (click)="requestDelete(editing.id)">üóëÔ∏è X√≥a</button>
      </div>
    </div>
  </div>

  <!-- List Modal -->
  <div class="modal-backdrop" *ngIf="listOpen">
    <div class="modal card" data-type="list">
      <div class="modal-head">
        <h3>üìñ Danh s√°ch c·∫•u h√¨nh</h3>
        <button class="close" (click)="listOpen = false">√ó</button>
      </div>
      <div class="modal-body">
        <table class="small">
          <thead>
            <tr>
              <th>S·ªë ng√†y TB</th>
              <th>TB tr∆∞·ªõc</th>
              <th>Tr·∫°ng th√°i</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let c of all">
              <td data-label="S·ªë ng√†y TB">{{ c.soNgayThongBao }} ng√†y</td>
              <td data-label="TB tr∆∞·ªõc">{{ c.soNgayThongBaoTruoc }} ng√†y</td>
              <td data-label="Tr·∫°ng th√°i">
                <span class="badge" [class.active]="c.isActive">{{ c.isActive ? 'ƒêang d√πng' : 'Ch∆∞a d√πng' }}</span>
              </td>
              <td class="row-actions">
                <button class="btn small primary" (click)="startEdit(c)">‚úèÔ∏è S·ª≠a</button>
                <button class="btn small success" (click)="activate(c.id)" *ngIf="!c.isActive">üîÑ K√≠ch ho·∫°t</button>
                <button *ngIf="c.id" class="btn small danger" (click)="requestDelete(c.id)">üóëÔ∏è X√≥a</button>
              </td>
            </tr>
            <tr *ngIf="all.length === 0">
              <td colspan="4" class="no-data">Kh√¥ng c√≥ d·ªØ li·ªáu</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-actions">
        <button class="btn" (click)="listOpen = false">ƒê√≥ng</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-backdrop" *ngIf="confirmDeleteId">
    <div class="modal card" data-type="delete">
      <div class="modal-head">
        <h3>‚ö†Ô∏è X√°c nh·∫≠n x√≥a</h3>
        <button class="close" (click)="cancelDelete()">√ó</button>
      </div>
      <div class="modal-body">
        <p>B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a c·∫•u h√¨nh #{{ confirmDeleteId }}? H√†nh ƒë·ªông <strong>kh√¥ng th·ªÉ ho√†n t√°c</strong>.</p>
      </div>
      <div class="modal-actions">
        <button class="btn" (click)="cancelDelete()">H·ªßy</button>
        <button class="btn danger" (click)="confirmDelete()">X√≥a</button>
      </div>
    </div>
  </div>
</div>