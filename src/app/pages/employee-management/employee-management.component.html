<div class="employee-management">
  <!-- Modern Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h2>
          <i class="icon-users"></i>
          Qu·∫£n l√Ω nh√¢n vi√™n
        </h2>
        <p class="subtitle">Qu·∫£n l√Ω th√¥ng tin v√† tr·∫°ng th√°i nh√¢n vi√™n</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-primary" (click)="openAddPopup()">
          <i class="icon-plus"></i>
          Th√™m nh√¢n vi√™n
        </button>
          <button class="btn" (click)="downloadTemplate()" title="T·∫£i file m·∫´u Excel">T·∫£i template</button>
          <button class="btn" (click)="openImportExcel()" title="Import t·ª´ Excel">Import Excel</button>
      </div>
    </div>
  </div>

  <!-- Search & Filter Section -->
  <div class="search-section">
    <div class="search-card">
      <div class="search-header">
        <h3>
          <i class="icon-search"></i>
          T√¨m ki·∫øm & L·ªçc
        </h3>
      </div>
      <div class="search-filters">
        <div class="filter-group">
          <label>T√™n nh√¢n vi√™n</label>
          <div class="input-wrapper">
            <i class="icon-user"></i>
            <input type="text" [(ngModel)]="searchTen" placeholder="Nh·∫≠p t√™n nh√¢n vi√™n...">
          </div>
        </div>
        <div class="filter-group">
          <label>S·ªë ƒëi·ªán tho·∫°i</label>
          <div class="input-wrapper">
            <i class="icon-phone"></i>
            <input type="text" [(ngModel)]="searchSoDienThoai" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i...">
          </div>
        </div>
        <div class="filter-group">
          <label>Tr·∫°ng th√°i</label>
          <div class="input-wrapper">
            <i class="icon-filter"></i>
            <select [(ngModel)]="searchStatus" (change)="onSearch()">
              <option value="active">C√≤n l√†m</option>
              <option value="inactive">Ngh·ªâ vi·ªác</option>
              <option value="all">T·∫•t c·∫£</option>
            </select>
          </div>
        </div>
        <div class="filter-actions">
          <button class="btn btn-search" (click)="onSearch()">
            <i class="icon-search"></i>
            T√¨m ki·∫øm
          </button>
          <button class="btn btn-reset" (click)="clearSearch()">
            <i class="icon-refresh"></i>
            L√†m m·ªõi
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Data Section -->
  <div class="data-section">
    <div class="data-header">
      <div class="stats">
        <div class="stat-item">
          <span class="stat-number">{{ totalAllEmployees }}</span>
          <span class="stat-label">T·ªïng nh√¢n vi√™n</span>
        </div>
        <div class="stat-item active">
          <span class="stat-number">{{ totalActiveEmployees }}</span>
          <span class="stat-label">ƒêang l√†m vi·ªác</span>
        </div>
        <div class="stat-item inactive">
          <span class="stat-number">{{ totalInactiveEmployees }}</span>
          <span class="stat-label">Ngh·ªâ vi·ªác</span>
        </div>
      </div>
    </div>

    <!-- Employee Cards -->
    <div class="employees-container">
      <div class="loading-state" *ngIf="loading">
        <div class="loading-spinner"></div>
        <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
      </div>
      
      <div class="employees-grid" *ngIf="!loading && employees.length > 0">
        <div class="employee-card" *ngFor="let emp of employees" [class.inactive]="emp.isDeleted">
          <div class="card-header">
            <div class="employee-avatar">
              <i class="icon-user-circle"></i>
            </div>
            <div class="employee-info">
              <h4 class="employee-name">{{ emp.ten }}</h4>
              <div class="employee-status">
                <span class="status-badge" [class]="emp.isDeleted ? 'status-inactive' : 'status-active'">
                  <i [class]="emp.isDeleted ? 'icon-user-x' : 'icon-user-check'"></i>
                  {{ emp.isDeleted ? 'Ngh·ªâ vi·ªác' : 'ƒêang l√†m' }}
                </span>
              </div>
            </div>
          </div>
          
          <div class="card-body">
            <div class="info-grid">
              <div class="info-item">
                <label><i class="icon-mail"></i> Email</label>
                <span>{{ emp.email }}</span>
              </div>
              <div class="info-item">
                <label><i class="icon-phone"></i> ƒêi·ªán tho·∫°i</label>
                <span>{{ emp.soDienThoai }}</span>
              </div>
              <div class="info-item full-width">
                <label><i class="icon-map-pin"></i> ƒê·ªãa ch·ªâ</label>
                <span>{{ emp.diaChi }}</span>
              </div>
              <div class="info-item">
                <label><i class="icon-calendar"></i> Ng√†y sinh</label>
                <span>{{ emp.ngaySinh | vnDate:'dd/MM/yyyy' }}</span>
              </div>
              <div class="info-item">
                <label><i class="icon-briefcase"></i> Ng√†y v√†o l√†m</label>
                <span>{{ emp.ngayVaoLam | vnDate:'dd/MM/yyyy' }}</span>
              </div>
              <div class="info-item full-width">
                <label><i class="icon-check-circle"></i> Ng√†y ch√≠nh th·ª©c</label>
                <span>{{ emp.ngayLamViecChinhThuc ? (emp.ngayLamViecChinhThuc | vnDate:'dd/MM/yyyy') : '--/--/--' }}</span>
              </div>
            </div>
          </div>
          
          <div class="card-actions">
            <button class="btn btn-outline" (click)="openEditPopup(emp)">
              <i class="icon-edit"></i>
              Ch·ªânh s·ª≠a
            </button>
            <button class="btn" 
                    [class.btn-success]="emp.isDeleted" 
                    [class.btn-warning]="!emp.isDeleted" 
                    (click)="openToggleStatusPopup(emp)">
              <i [class]="emp.isDeleted ? 'icon-user-plus' : 'icon-user-minus'"></i>
              {{ emp.isDeleted ? 'Kh√¥i ph·ª•c' : 'Ngh·ªâ vi·ªác' }}
            </button>
          </div>
        </div>
      </div>
      
      <div class="empty-state" *ngIf="!loading && employees.length === 0">
        <div class="empty-icon">
          <i class="icon-users"></i>
        </div>
        <h3>Kh√¥ng c√≥ nh√¢n vi√™n n√†o</h3>
        <p>Ch∆∞a c√≥ d·ªØ li·ªáu nh√¢n vi√™n ho·∫∑c kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p</p>
        <button class="btn btn-primary" (click)="openAddPopup()">
          <i class="icon-plus"></i>
          Th√™m nh√¢n vi√™n ƒë·∫ßu ti√™n
        </button>
      </div>
    </div>

    <!-- Modern Pagination -->
    <div class="pagination-section" *ngIf="!loading && employees.length > 0">
      <div class="pagination-info">
        <span>Hi·ªÉn th·ªã {{ employees.length }} trong t·ªïng s·ªë {{ totalItems }} nh√¢n vi√™n</span>
      </div>
      <div class="pagination-controls">
        <button class="btn btn-outline" (click)="onPrevPage()" [disabled]="page === 1">
          <i class="icon-chevron-left"></i>
          Tr∆∞·ªõc
        </button>
        <div class="page-numbers">
          <span class="current-page">{{ page }}</span>
          <span class="page-separator">c·ªßa</span>
          <span class="total-pages">{{ totalPages }}</span>
        </div>
        <button class="btn btn-outline" (click)="onNextPage()" [disabled]="page === totalPages">
          Sau
          <i class="icon-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Modern Modal -->
  <div class="modal-backdrop" [class.active]="popupType" (click)="closePopup()">
    <div class="modal" [class.active]="popupType" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>
          <i [class]="popupType === 'add' ? 'icon-user-plus' : popupType === 'edit' ? 'icon-edit' : 'icon-alert-circle'"></i>
          {{ popupTitle }}
        </h3>
        <button class="modal-close" (click)="closePopup()">
          <i class="icon-x"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <ng-container [ngSwitch]="popupType">
          <!-- Add Form -->
          <ng-container *ngSwitchCase="'add'">
            <div class="form-grid">
              <div class="form-group">
                <label for="add-ten">
                  <i class="icon-user"></i>
                  H·ªç v√† t√™n *
                </label>
                <input id="add-ten" [(ngModel)]="newEmployee.ten" [class.error]="addFormErrors['ten']" placeholder="Nh·∫≠p h·ªç t√™n nh√¢n vi√™n">
                <div *ngIf="addFormErrors['ten']" class="field-error">{{ addFormErrors['ten'] }}</div>
              </div>
              
              <div class="form-group">
                <label for="add-email">
                  <i class="icon-mail"></i>
                  Email *
                </label>
                <input id="add-email" type="email" [(ngModel)]="newEmployee.email" [class.error]="addFormErrors['email']" placeholder="email@example.com">
                <div *ngIf="addFormErrors['email']" class="field-error">{{ addFormErrors['email'] }}</div>
              </div>
              
              <div class="form-group">
                <label for="add-soDienThoai">
                  <i class="icon-phone"></i>
                  S·ªë ƒëi·ªán tho·∫°i *
                </label>
                <input id="add-soDienThoai" [(ngModel)]="newEmployee.soDienThoai" [class.error]="addFormErrors['soDienThoai']" placeholder="0xxx xxx xxx">
                <div *ngIf="addFormErrors['soDienThoai']" class="field-error">{{ addFormErrors['soDienThoai'] }}</div>
              </div>
              
              <div class="form-group full-width">
                <label for="add-diaChi">
                  <i class="icon-map-pin"></i>
                  ƒê·ªãa ch·ªâ *
                </label>
                <textarea id="add-diaChi" [(ngModel)]="newEmployee.diaChi" [class.error]="addFormErrors['diaChi']" 
                          rows="3" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ ƒë·∫ßy ƒë·ªß c·ªßa nh√¢n vi√™n"></textarea>
                <div *ngIf="addFormErrors['diaChi']" class="field-error">{{ addFormErrors['diaChi'] }}</div>
              </div>
              
              <div class="form-group">
                <label for="add-ngaySinh">
                  <i class="icon-calendar"></i>
                  Ng√†y sinh *
                </label>
                <input id="add-ngaySinh" type="date" [(ngModel)]="newEmployee.ngaySinh" [class.error]="addFormErrors['ngaySinh']">
                <div *ngIf="addFormErrors['ngaySinh']" class="field-error">{{ addFormErrors['ngaySinh'] }}</div>
              </div>
              
              <div class="form-group">
                <label for="add-ngayVaoLam">
                  <i class="icon-briefcase"></i>
                  Ng√†y v√†o l√†m *
                </label>
                <input id="add-ngayVaoLam" type="date" [(ngModel)]="newEmployee.ngayVaoLam" [class.error]="addFormErrors['ngayVaoLam']">
                <div *ngIf="addFormErrors['ngayVaoLam']" class="field-error">{{ addFormErrors['ngayVaoLam'] }}</div>
              </div>
              
              <div class="form-group full-width">
                <label for="add-ngayLamViecChinhThuc">
                  <i class="icon-check-circle"></i>
                  Ng√†y l√†m vi·ªác ch√≠nh th·ª©c
                  <small>(Kh√¥ng b·∫Øt bu·ªôc)</small>
                </label>
                <input id="add-ngayLamViecChinhThuc" type="date" [(ngModel)]="newEmployee.ngayLamViecChinhThuc" [class.error]="addFormErrors['ngayLamViecChinhThuc']">
                <div *ngIf="addFormErrors['ngayLamViecChinhThuc']" class="field-error">{{ addFormErrors['ngayLamViecChinhThuc'] }}</div>
              </div>
            </div>
          </ng-container>
          
          <!-- Edit Form -->
          <ng-container *ngSwitchCase="'edit'">
            <div class="form-grid">
              <div class="form-group">
                <label for="edit-ten">
                  <i class="icon-user"></i>
                  H·ªç v√† t√™n *
                </label>
                <input id="edit-ten" [(ngModel)]="editModel!.ten" [class.error]="editFormErrors['ten']" placeholder="Nh·∫≠p h·ªç t√™n nh√¢n vi√™n">
                <div *ngIf="editFormErrors['ten']" class="field-error">{{ editFormErrors['ten'] }}</div>
              </div>
              
              <div class="form-group">
                <label for="edit-email">
                  <i class="icon-mail"></i>
                  Email *
                </label>
                <input id="edit-email" type="email" [(ngModel)]="editModel!.email" [class.error]="editFormErrors['email']" placeholder="email@example.com">
                <div *ngIf="editFormErrors['email']" class="field-error">{{ editFormErrors['email'] }}</div>
              </div>
              
              <div class="form-group">
                <label for="edit-soDienThoai">
                  <i class="icon-phone"></i>
                  S·ªë ƒëi·ªán tho·∫°i *
                </label>
                <input id="edit-soDienThoai" [(ngModel)]="editModel!.soDienThoai" [class.error]="editFormErrors['soDienThoai']" placeholder="0xxx xxx xxx">
                <div *ngIf="editFormErrors['soDienThoai']" class="field-error">{{ editFormErrors['soDienThoai'] }}</div>
              </div>
              
              <div class="form-group full-width">
                <label for="edit-diaChi">
                  <i class="icon-map-pin"></i>
                  ƒê·ªãa ch·ªâ *
                </label>
                <textarea id="edit-diaChi" [(ngModel)]="editModel!.diaChi" [class.error]="editFormErrors['diaChi']" 
                          rows="3" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ ƒë·∫ßy ƒë·ªß c·ªßa nh√¢n vi√™n"></textarea>
                <div *ngIf="editFormErrors['diaChi']" class="field-error">{{ editFormErrors['diaChi'] }}</div>
              </div>
              
              <div class="form-group">
                <label for="edit-ngaySinh">
                  <i class="icon-calendar"></i>
                  Ng√†y sinh *
                </label>
                <input id="edit-ngaySinh" type="date" [(ngModel)]="editModel!.ngaySinh" [class.error]="editFormErrors['ngaySinh']">
                <div *ngIf="editFormErrors['ngaySinh']" class="field-error">{{ editFormErrors['ngaySinh'] }}</div>
              </div>
              
              <div class="form-group">
                <label for="edit-ngayVaoLam">
                  <i class="icon-briefcase"></i>
                  Ng√†y v√†o l√†m *
                </label>
                <input id="edit-ngayVaoLam" type="date" [(ngModel)]="editModel!.ngayVaoLam" [class.error]="editFormErrors['ngayVaoLam']">
                <div *ngIf="editFormErrors['ngayVaoLam']" class="field-error">{{ editFormErrors['ngayVaoLam'] }}</div>
              </div>
              
              <div class="form-group full-width">
                <label for="edit-ngayLamViecChinhThuc">
                  <i class="icon-check-circle"></i>
                  Ng√†y l√†m vi·ªác ch√≠nh th·ª©c
                  <small>(Kh√¥ng b·∫Øt bu·ªôc)</small>
                </label>
                <input id="edit-ngayLamViecChinhThuc" type="date" [(ngModel)]="editModel!.ngayLamViecChinhThuc" [class.error]="editFormErrors['ngayLamViecChinhThuc']">
                <div *ngIf="editFormErrors['ngayLamViecChinhThuc']" class="field-error">{{ editFormErrors['ngayLamViecChinhThuc'] }}</div>
              </div>
            </div>
          </ng-container>
          
          <!-- Import Excel -->
          <ng-container *ngSwitchCase="'import-excel'">
            <div class="import-excel-wrapper">
              <div class="step">
                <span class="step-index">1</span>
                <div class="step-content">
                  <p>T·∫£i file m·∫´u n·∫øu ch∆∞a c√≥:</p>
                  <button type="button" class="btn btn-outline btn-sm" (click)="downloadTemplate()">
                    <i class="icon-download"></i> T·∫£i template
                  </button>
                </div>
              </div>
              <div class="step">
                <span class="step-index">2</span>
                <div class="step-content">
                  <p>ƒêi·ªÅn d·ªØ li·ªáu nh√¢n vi√™n theo ƒë√∫ng c·ªôt h∆∞·ªõng d·∫´n trong file.</p>
                </div>
              </div>
              <div class="step">
                <span class="step-index">3</span>
                <div class="step-content">
                  <p>Ch·ªçn file Excel ƒë·ªÉ import:</p>
                  <div class="upload-box" [class.loading]="importLoading">
                    <input type="file" accept=".xlsx,.xls" (change)="onFileSelected($event)" [disabled]="importLoading" />
                    <div class="file-info" *ngIf="importFile">
                      <i class="icon-file"></i> {{ importFile.name }}
                      <button type="button" class="clear-file" (click)="importFile=null" [disabled]="importLoading">√ó</button>
                    </div>
                    <div class="placeholder" *ngIf="!importFile">K√©o th·∫£ ho·∫∑c ch·ªçn file .xlsx / .xls</div>
                  </div>
                </div>
              </div>
              <div class="import-hint">
                <small><strong>L∆∞u √Ω:</strong> C√°c h√†ng tr·ªëng s·∫Ω b·ªã b·ªè qua. Vui l√≤ng ki·ªÉm tra ƒë·ªãnh d·∫°ng ng√†y (dd/MM/yyyy).</small>
              </div>

              <!-- Import Result Summary -->
              <div class="import-result" *ngIf="importResult">
                <div class="result-summary" [class.has-errors]="importResult.failedCount > 0">
                  <div class="summary-item success">
                    <i class="icon-check-circle"></i>
                    <span>{{ importResult.successCount }} th√†nh c√¥ng</span>
                  </div>
                  <div class="summary-item error" *ngIf="importResult.failedCount > 0">
                    <i class="icon-alert-circle"></i>
                    <span>{{ importResult.failedCount }} th·∫•t b·∫°i</span>
                  </div>
                  <div class="summary-item total">
                    <span>T·ªïng: {{ importResult.totalRows }} d√≤ng</span>
                  </div>
                </div>

                <!-- Error Details Table -->
                <div class="error-details" *ngIf="importResult.errors && importResult.errors.length > 0">
                  <h4><i class="icon-alert-circle"></i> Chi ti·∫øt l·ªói</h4>
                  <div class="error-table-wrapper">
                    <table class="error-table">
                      <thead>
                        <tr>
                          <th>D√≤ng</th>
                          <th>L·ªói</th>
                          <th>D·ªØ li·ªáu</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let err of importResult.errors">
                          <td class="row-number">{{ err.row }}</td>
                          <td class="error-message">{{ err.error }}</td>
                          <td class="error-data">{{ err.data }}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="error-actions">
                    <small>üí° Vui l√≤ng s·ª≠a c√°c l·ªói tr√™n v√† th·ª≠ import l·∫°i.</small>
                  </div>
                </div>
              </div>

              <div class="loading-overlay" *ngIf="importLoading">
                <div class="spinner"></div>
                <p>ƒêang import d·ªØ li·ªáu...</p>
              </div>
            </div>
          </ng-container>

          <!-- Confirmation -->
          <ng-container *ngSwitchCase="'toggle-status'">
            <div class="confirmation-content">
              <div class="confirmation-icon" [class]="toggleStatusEmployee?.isDeleted ? 'restore' : 'deactivate'">
                <i [class]="toggleStatusEmployee?.isDeleted ? 'icon-user-check' : 'icon-user-x'"></i>
              </div>
              <div class="confirmation-text">
                <p *ngIf="toggleStatusEmployee?.isDeleted">
                  B·∫°n c√≥ ch·∫Øc mu·ªën <strong>kh√¥i ph·ª•c</strong> nh√¢n vi√™n 
                  <strong>{{ toggleStatusEmployee?.ten }}</strong> v·ªÅ tr·∫°ng th√°i c√≤n l√†m vi·ªác kh√¥ng?
                </p>
                <p *ngIf="!toggleStatusEmployee?.isDeleted">
                  B·∫°n c√≥ ch·∫Øc mu·ªën chuy·ªÉn nh√¢n vi√™n 
                  <strong>{{ toggleStatusEmployee?.ten }}</strong> sang tr·∫°ng th√°i <strong>ngh·ªâ vi·ªác</strong> kh√¥ng?
                </p>
                <small>Thao t√°c n√†y c√≥ th·ªÉ ho√†n t√°c ƒë∆∞·ª£c.</small>
              </div>
            </div>
          </ng-container>
        </ng-container>
      </div>
      
      <div class="modal-actions" *ngIf="popupType !== 'import-excel'">
        <button class="btn btn-outline" (click)="closePopup()">
          <i class="icon-x"></i>
          H·ªßy b·ªè
        </button>
        <button *ngIf="popupType === 'add'" class="btn btn-primary" (click)="addEmployee()">
          <i class="icon-plus"></i>
          Th√™m nh√¢n vi√™n
        </button>
        <button *ngIf="popupType === 'edit'" class="btn btn-primary" (click)="saveEdit()">
          <i class="icon-save"></i>
          L∆∞u thay ƒë·ªïi
        </button>
        <button *ngIf="popupType === 'toggle-status'" 
                class="btn" 
                [class.btn-success]="toggleStatusEmployee?.isDeleted"
                [class.btn-warning]="!toggleStatusEmployee?.isDeleted"
                (click)="toggleEmployeeStatus()">
          <i [class]="toggleStatusEmployee?.isDeleted ? 'icon-user-check' : 'icon-user-x'"></i>
          {{ toggleStatusEmployee?.isDeleted ? 'Kh√¥i ph·ª•c' : 'Ngh·ªâ vi·ªác' }}
        </button>
      </div>

      <!-- Import Excel Actions -->
      <div class="modal-actions import-excel-actions" *ngIf="popupType === 'import-excel'">
        <button class="btn btn-outline" (click)="closePopup()" [disabled]="importLoading">
          <i class="icon-x"></i>
          {{ importResult ? 'ƒê√≥ng' : 'H·ªßy' }}
        </button>
        <button class="btn btn-primary" (click)="importExcel()" [disabled]="importLoading || !importFile" *ngIf="!importResult">
          <i class="icon-upload"></i>
          <span *ngIf="!importLoading">Import ngay</span>
          <span *ngIf="importLoading">ƒêang x·ª≠ l√Ω...</span>
        </button>
        <button class="btn btn-success" (click)="importResult = null; importFile = null" *ngIf="importResult && importResult.failedCount > 0">
          <i class="icon-refresh"></i>
          Th·ª≠ l·∫°i
        </button>
      </div>
    </div>
  </div>
</div>