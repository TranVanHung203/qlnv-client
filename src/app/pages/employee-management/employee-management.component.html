<div class="employee-management">
  <!-- Modern Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h2>
          <i class="icon-users"></i>
          Quản lý nhân viên
        </h2>
        <p class="subtitle">Quản lý thông tin và trạng thái nhân viên</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-primary" (click)="openAddPopup()">
          <i class="icon-plus"></i>
          Thêm nhân viên
        </button>
          <button class="btn" (click)="downloadTemplate()" title="Tải file mẫu Excel">Tải template</button>
          <button class="btn" (click)="openImportExcel()" title="Import từ Excel">Import Excel</button>
      </div>
    </div>
  </div>

  <!-- Search & Filter Section -->
  <div class="search-section">
    <div class="search-card">
      <div class="search-header">
        <h3>
          <i class="icon-search"></i>
          Tìm kiếm & Lọc
        </h3>
      </div>
      <div class="search-filters">
        <div class="filter-group">
          <label>Tên nhân viên</label>
          <div class="input-wrapper">
            <i class="icon-user"></i>
            <input type="text" [(ngModel)]="searchTen" placeholder="Nhập tên nhân viên...">
          </div>
        </div>
        <div class="filter-group">
          <label>Số điện thoại</label>
          <div class="input-wrapper">
            <i class="icon-phone"></i>
            <input type="text" [(ngModel)]="searchSoDienThoai" placeholder="Nhập số điện thoại...">
          </div>
        </div>
        <div class="filter-group">
          <label>Trạng thái</label>
          <div class="input-wrapper">
            <i class="icon-filter"></i>
            <select [(ngModel)]="searchStatus" (change)="onSearch()">
              <option value="active">Còn làm</option>
              <option value="inactive">Nghỉ việc</option>
              <option value="all">Tất cả</option>
            </select>
          </div>
        </div>
        <div class="filter-actions">
          <button class="btn btn-search" (click)="onSearch()">
            <i class="icon-search"></i>
            Tìm kiếm
          </button>
          <button class="btn btn-reset" (click)="clearSearch()">
            <i class="icon-refresh"></i>
            Làm mới
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Data Section -->
  <div class="data-section">
    <div class="data-header">
      <div class="stats">
        <div class="stat-item">
          <span class="stat-number">{{ totalAllEmployees }}</span>
          <span class="stat-label">Tổng nhân viên</span>
        </div>
        <div class="stat-item active">
          <span class="stat-number">{{ totalActiveEmployees }}</span>
          <span class="stat-label">Đang làm việc</span>
        </div>
        <div class="stat-item inactive">
          <span class="stat-number">{{ totalInactiveEmployees }}</span>
          <span class="stat-label">Nghỉ việc</span>
        </div>
      </div>
    </div>

    <!-- Employee Cards -->
    <div class="employees-container">
      <div class="loading-state" *ngIf="loading">
        <div class="loading-spinner"></div>
        <p>Đang tải dữ liệu...</p>
      </div>
      
      <div class="employees-grid" *ngIf="!loading && employees.length > 0">
        <div class="employee-card" *ngFor="let emp of employees" [class.inactive]="emp.isDeleted">
          <div class="card-header">
            <div class="employee-avatar">
              <i class="icon-user-circle"></i>
            </div>
            <div class="employee-info">
              <h4 class="employee-name">{{ emp.ten }}</h4>
              <div class="employee-status">
                <span class="status-badge" [class]="emp.isDeleted ? 'status-inactive' : 'status-active'">
                  <i [class]="emp.isDeleted ? 'icon-user-x' : 'icon-user-check'"></i>
                  {{ emp.isDeleted ? 'Nghỉ việc' : 'Đang làm' }}
                </span>
              </div>
            </div>
          </div>
          
          <div class="card-body">
            <div class="info-grid">
              <div class="info-item">
                <label><i class="icon-mail"></i> Email</label>
                <span>{{ emp.email }}</span>
              </div>
              <div class="info-item">
                <label><i class="icon-phone"></i> Điện thoại</label>
                <span>{{ emp.soDienThoai }}</span>
              </div>
              <div class="info-item full-width">
                <label><i class="icon-map-pin"></i> Địa chỉ</label>
                <span>{{ emp.diaChi }}</span>
              </div>
              <div class="info-item">
                <label><i class="icon-calendar"></i> Ngày sinh</label>
                <span>{{ emp.ngaySinh | vnDate:'dd/MM/yyyy' }}</span>
              </div>
              <div class="info-item">
                <label><i class="icon-briefcase"></i> Ngày thử việc</label>
                <span>{{ emp.ngayVaoLam ? (emp.ngayVaoLam | vnDate:'dd/MM/yyyy') : '--/--/--' }}</span>
              </div>
              <div class="info-item full-width">
                <label><i class="icon-check-circle"></i>Ngày kí hợp đồng chính thức</label>
                <span>{{ emp.ngayLamViecChinhThuc ? (emp.ngayLamViecChinhThuc | vnDate:'dd/MM/yyyy') : '--/--/--' }}</span>
              </div>
              <div class="info-item">
                <label><i class="icon-calendar"></i> Ngày kết thúc thử việc</label>
                <span>{{ emp.ngayKetThucThuViec ? (emp.ngayKetThucThuViec | vnDate:'dd/MM/yyyy') : '--/--/--' }}</span>
              </div>
              <div class="info-item">
                <label><i class="icon-calendar"></i> Ngày kết thúc hợp đồng</label>
                <span>{{ emp.ngayKetThucHopDong ? (emp.ngayKetThucHopDong | vnDate:'dd/MM/yyyy') : '--/--/--' }}</span>
              </div>
              <div class="info-item" *ngIf="emp.isDeleted">
                <label><i class="icon-x-circle"></i> Ngày nghỉ việc</label>
                <span>{{ emp.ngayNghiViec ? (emp.ngayNghiViec | vnDate:'dd/MM/yyyy') : '--/--/--' }}</span>
              </div>
              <div class="info-item">
                <label><i class="icon-briefcase"></i> Loại hợp đồng</label>
                <span>
                  <ng-container *ngIf="emp.loaiHopDong === 'vothoihan'">Vô thời hạn</ng-container>
                  <ng-container *ngIf="emp.loaiHopDong === '1nam'">1 năm</ng-container>
                  <ng-container *ngIf="emp.loaiHopDong === 'khac'">Khác ({{ emp.soThangHopDong === 999 ? 'Vô thời hạn' : emp.soThangHopDong + ' tháng' }})</ng-container>
                  <ng-container *ngIf="!emp.loaiHopDong">--</ng-container>
                </span>
              </div>
            </div>
          </div>
          
          <div class="card-actions">
            <button class="btn btn-outline" (click)="openContractHistory(emp)">
              <i class="icon-file-text"></i>
              Lịch sử HĐ
            </button>
            <button class="btn btn-outline" (click)="openEditPopup(emp)">
              <i class="icon-edit"></i>
              Chỉnh sửa
            </button>
            <button class="btn" 
                    [class.btn-success]="emp.isDeleted" 
                    [class.btn-warning]="!emp.isDeleted" 
                    (click)="openToggleStatusPopup(emp)">
              <i [class]="emp.isDeleted ? 'icon-user-plus' : 'icon-user-minus'"></i>
              {{ emp.isDeleted ? 'Khôi phục' : 'Nghỉ việc' }}
            </button>
          </div>
        </div>
      </div>
      
      <div class="empty-state" *ngIf="!loading && employees.length === 0">
        <div class="empty-icon">
          <i class="icon-users"></i>
        </div>
        <h3>Không có nhân viên nào</h3>
        <p>Chưa có dữ liệu nhân viên hoặc không tìm thấy kết quả phù hợp</p>
        <button class="btn btn-primary" (click)="openAddPopup()">
          <i class="icon-plus"></i>
          Thêm nhân viên đầu tiên
        </button>
      </div>
    </div>

    <!-- Modern Pagination -->
    <div class="pagination-section" *ngIf="!loading && employees.length > 0">
      <div class="pagination-info">
        <span>Hiển thị {{ employees.length }} trong tổng số {{ totalItems }} nhân viên</span>
      </div>
      <div class="pagination-controls">
        <button class="btn btn-outline" (click)="onPrevPage()" [disabled]="page === 1">
          <i class="icon-chevron-left"></i>
          Trước
        </button>
        <div class="page-numbers">
          <span class="current-page">{{ page }}</span>
          <span class="page-separator">của</span>
          <span class="total-pages">{{ totalPages }}</span>
        </div>
        <button class="btn btn-outline" (click)="onNextPage()" [disabled]="page === totalPages">
          Sau
          <i class="icon-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Modern Modal -->
  <div class="modal-backdrop" [class.active]="popupType" (click)="closePopup()">
    <div class="modal" [class.active]="popupType" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>
          <i [class]="popupType === 'add' ? 'icon-user-plus' : popupType === 'edit' ? 'icon-edit' : 'icon-alert-circle'"></i>
          {{ popupTitle }}
        </h3>
        <button class="modal-close" (click)="closePopup()">
          <i class="icon-x"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <ng-container [ngSwitch]="popupType">
          <!-- Add Form -->
          <ng-container *ngSwitchCase="'add'">
            <div class="form-grid">
              <div class="form-group">
                <label for="add-ten">
                  <i class="icon-user"></i>
                  Họ và tên *
                </label>
                <input id="add-ten" [(ngModel)]="newEmployee.ten" [class.error]="addFormErrors['ten']" placeholder="Nhập họ tên nhân viên">
                <div *ngIf="addFormErrors['ten']" class="field-error">{{ addFormErrors['ten'] }}</div>
              </div>
              
              <div class="form-group">
                <label for="add-email">
                  <i class="icon-mail"></i>
                  Email
                </label>
                <input id="add-email" type="email" [(ngModel)]="newEmployee.email" [class.error]="addFormErrors['email']" placeholder="email@example.com">
                <div *ngIf="addFormErrors['email']" class="field-error">{{ addFormErrors['email'] }}</div>
              </div>
              
              <div class="form-group">
                <label for="add-soDienThoai">
                  <i class="icon-phone"></i>
                  Số điện thoại
                </label>
                <input id="add-soDienThoai" [(ngModel)]="newEmployee.soDienThoai" [class.error]="addFormErrors['soDienThoai']" placeholder="0xxx xxx xxx">
                <div *ngIf="addFormErrors['soDienThoai']" class="field-error">{{ addFormErrors['soDienThoai'] }}</div>
              </div>
              
              <div class="form-group full-width">
                <label for="add-diaChi">
                  <i class="icon-map-pin"></i>
                  Địa chỉ
                  <small>(Không bắt buộc)</small>
                </label>
                <textarea id="add-diaChi" [(ngModel)]="newEmployee.diaChi" [class.error]="addFormErrors['diaChi']" 
                          rows="3" placeholder="Nhập địa chỉ đầy đủ của nhân viên"></textarea>
                <div *ngIf="addFormErrors['diaChi']" class="field-error">{{ addFormErrors['diaChi'] }}</div>
              </div>
              
              <div class="form-group">
                <label for="add-ngaySinh">
                  <i class="icon-calendar"></i>
                  Ngày sinh *
                </label>
                <input id="add-ngaySinh" type="date" [(ngModel)]="newEmployee.ngaySinh" [class.error]="addFormErrors['ngaySinh']">
                <div *ngIf="addFormErrors['ngaySinh']" class="field-error">{{ addFormErrors['ngaySinh'] }}</div>
              </div>
              
              <div class="form-group">
                <label for="add-ngayVaoLam">
                  <i class="icon-briefcase"></i>
                  Ngày thử việc
                  <small>(Không bắt buộc)</small>
                </label>
                <input id="add-ngayVaoLam" type="date" [(ngModel)]="newEmployee.ngayVaoLam" [class.error]="addFormErrors['ngayVaoLam']">
                <div *ngIf="addFormErrors['ngayVaoLam']" class="field-error">{{ addFormErrors['ngayVaoLam'] }}</div>
              </div>
              
              <div class="form-group full-width">
                <label for="add-ngayLamViecChinhThuc">
                  <i class="icon-check-circle"></i>
                  Ngày kí hợp đồng chính thức
                  <small>(Không bắt buộc)</small>
                </label>
                <input id="add-ngayLamViecChinhThuc" type="date" [(ngModel)]="newEmployee.ngayLamViecChinhThuc" [class.error]="addFormErrors['ngayLamViecChinhThuc']">
                <div *ngIf="addFormErrors['ngayLamViecChinhThuc']" class="field-error">{{ addFormErrors['ngayLamViecChinhThuc'] }}</div>
              </div>

              <div class="form-group">
                <label for="add-ngayKetThucThuViec">
                  <i class="icon-calendar"></i>
                  Ngày kết thúc thử việc
                  <small>(Không bắt buộc)</small>
                </label>
                <input id="add-ngayKetThucThuViec" type="date" [(ngModel)]="newEmployee.ngayKetThucThuViec" [class.error]="addFormErrors['ngayKetThucThuViec']">
                <div *ngIf="addFormErrors['ngayKetThucThuViec']" class="field-error">{{ addFormErrors['ngayKetThucThuViec'] }}</div>
              </div>

              <div class="form-group">
                <label for="add-ngayKetThucHopDong">
                  <i class="icon-calendar"></i>
                  Ngày kết thúc hợp đồng
                  <small>(Không bắt buộc)</small>
                </label>
                <input id="add-ngayKetThucHopDong" type="date" [(ngModel)]="newEmployee.ngayKetThucHopDong" [class.error]="addFormErrors['ngayKetThucHopDong']">
                <div *ngIf="addFormErrors['ngayKetThucHopDong']" class="field-error">{{ addFormErrors['ngayKetThucHopDong'] }}</div>
              </div>

              <div class="form-group">
                <label for="add-loaiHopDong">
                  <i class="icon-briefcase"></i>
                  Loại hợp đồng *
                </label>
                <select id="add-loaiHopDong" [(ngModel)]="newEmployee.loaiHopDong" [class.error]="addFormErrors['loaiHopDong']">
                  <option value="vothoihan">Vô thời hạn</option>
                  <option value="1nam">1 năm</option>
                  <option value="khac">Khác</option>
                </select>
                <div *ngIf="addFormErrors['loaiHopDong']" class="field-error">{{ addFormErrors['loaiHopDong'] }}</div>
              </div>

              <div class="form-group" *ngIf="newEmployee.loaiHopDong === 'khac'">
                <label for="add-soThangHopDong">
                  <i class="icon-calendar"></i>
                  Số tháng hợp đồng *
                </label>
                <input id="add-soThangHopDong" type="number" min="1" [(ngModel)]="newEmployee.soThangHopDong" [class.error]="addFormErrors['soThangHopDong']" placeholder="Nhập số tháng">
                <div *ngIf="addFormErrors['soThangHopDong']" class="field-error">{{ addFormErrors['soThangHopDong'] }}</div>
              </div>
            </div>
          </ng-container>
          
          <!-- Edit Form -->
          <ng-container *ngSwitchCase="'edit'">
            <div class="form-grid">
              <div class="form-group">
                <label for="edit-ten">
                  <i class="icon-user"></i>
                  Họ và tên *
                </label>
                <input id="edit-ten" [(ngModel)]="editModel!.ten" [class.error]="editFormErrors['ten']" placeholder="Nhập họ tên nhân viên">
                <div *ngIf="editFormErrors['ten']" class="field-error">{{ editFormErrors['ten'] }}</div>
              </div>
              
              <div class="form-group">
                <label for="edit-email">
                  <i class="icon-mail"></i>
                  Email
                </label>
                <input id="edit-email" type="email" [(ngModel)]="editModel!.email" [class.error]="editFormErrors['email']" placeholder="email@example.com">
                <div *ngIf="editFormErrors['email']" class="field-error">{{ editFormErrors['email'] }}</div>
              </div>
              
              <div class="form-group">
                <label for="edit-soDienThoai">
                  <i class="icon-phone"></i>
                  Số điện thoại
                </label>
                <input id="edit-soDienThoai" [(ngModel)]="editModel!.soDienThoai" [class.error]="editFormErrors['soDienThoai']" placeholder="0xxx xxx xxx">
                <div *ngIf="editFormErrors['soDienThoai']" class="field-error">{{ editFormErrors['soDienThoai'] }}</div>
              </div>
              
              <div class="form-group full-width">
                <label for="edit-diaChi">
                  <i class="icon-map-pin"></i>
                  Địa chỉ
                  <small>(Không bắt buộc)</small>
                </label>
                <textarea id="edit-diaChi" [(ngModel)]="editModel!.diaChi" [class.error]="editFormErrors['diaChi']" 
                          rows="3" placeholder="Nhập địa chỉ đầy đủ của nhân viên"></textarea>
                <div *ngIf="editFormErrors['diaChi']" class="field-error">{{ editFormErrors['diaChi'] }}</div>
              </div>
              
              <div class="form-group">
                <label for="edit-ngaySinh">
                  <i class="icon-calendar"></i>
                  Ngày sinh *
                </label>
                <input id="edit-ngaySinh" type="date" [(ngModel)]="editModel!.ngaySinh" [class.error]="editFormErrors['ngaySinh']">
                <div *ngIf="editFormErrors['ngaySinh']" class="field-error">{{ editFormErrors['ngaySinh'] }}</div>
              </div>
              
              <div class="form-group">
                <label for="edit-ngayVaoLam">
                  <i class="icon-briefcase"></i>
                  Ngày thử việc
                  <small>(Không bắt buộc)</small>
                </label>
                <input id="edit-ngayVaoLam" type="date" [(ngModel)]="editModel!.ngayVaoLam" [class.error]="editFormErrors['ngayVaoLam']">
                <div *ngIf="editFormErrors['ngayVaoLam']" class="field-error">{{ editFormErrors['ngayVaoLam'] }}</div>
              </div>
              
              <div class="form-group full-width">
                <label for="edit-ngayLamViecChinhThuc">
                  <i class="icon-check-circle"></i>
                  Ngày kí hợp đồng chính thức
                  <small>(Không bắt buộc)</small>
                </label>
                <input id="edit-ngayLamViecChinhThuc" type="date" [(ngModel)]="editModel!.ngayLamViecChinhThuc" [class.error]="editFormErrors['ngayLamViecChinhThuc']">
                <div *ngIf="editFormErrors['ngayLamViecChinhThuc']" class="field-error">{{ editFormErrors['ngayLamViecChinhThuc'] }}</div>
              </div>

              <div class="form-group">
                <label for="edit-ngayKetThucThuViec">
                  <i class="icon-calendar"></i>
                  Ngày kết thúc thử việc
                  <small>(Không bắt buộc)</small>
                </label>
                <input id="edit-ngayKetThucThuViec" type="date" [(ngModel)]="editModel!.ngayKetThucThuViec" [class.error]="editFormErrors['ngayKetThucThuViec']">
                <div *ngIf="editFormErrors['ngayKetThucThuViec']" class="field-error">{{ editFormErrors['ngayKetThucThuViec'] }}</div>
              </div>

              <div class="form-group">
                <label for="edit-ngayKetThucHopDong">
                  <i class="icon-calendar"></i>
                  Ngày kết thúc hợp đồng
                  <small>(Không bắt buộc)</small>
                </label>
                <input id="edit-ngayKetThucHopDong" type="date" [(ngModel)]="editModel!.ngayKetThucHopDong" [class.error]="editFormErrors['ngayKetThucHopDong']">
                <div *ngIf="editFormErrors['ngayKetThucHopDong']" class="field-error">{{ editFormErrors['ngayKetThucHopDong'] }}</div>
              </div>

              <div class="form-group">
                <label for="edit-loaiHopDong">
                  <i class="icon-briefcase"></i>
                  Loại hợp đồng *
                </label>
                <select id="edit-loaiHopDong" [(ngModel)]="editModel!.loaiHopDong" [class.error]="editFormErrors['loaiHopDong']">
                  <option value="vothoihan">Vô thời hạn</option>
                  <option value="1nam">1 năm</option>
                  <option value="khac">Khác</option>
                </select>
                <div *ngIf="editFormErrors['loaiHopDong']" class="field-error">{{ editFormErrors['loaiHopDong'] }}</div>
              </div>

              <div class="form-group" *ngIf="editModel!.loaiHopDong === 'khac'">
                <label for="edit-soThangHopDong">
                  <i class="icon-calendar"></i>
                  Số tháng hợp đồng *
                </label>
                <input id="edit-soThangHopDong" type="number" min="1" [(ngModel)]="editModel!.soThangHopDong" [class.error]="editFormErrors['soThangHopDong']" placeholder="Nhập số tháng">
                <div *ngIf="editFormErrors['soThangHopDong']" class="field-error">{{ editFormErrors['soThangHopDong'] }}</div>
              </div>
            </div>
          </ng-container>
          
          <!-- Import Excel -->
          <ng-container *ngSwitchCase="'import-excel'">
            <div class="import-excel-wrapper">
              <div class="step">
                <span class="step-index">1</span>
                <div class="step-content">
                  <p>Tải file mẫu nếu chưa có:</p>
                  <button type="button" class="btn btn-outline btn-sm" (click)="downloadTemplate()">
                    <i class="icon-download"></i> Tải template
                  </button>
                </div>
              </div>
              <div class="step">
                <span class="step-index">2</span>
                <div class="step-content">
                  <p>Điền dữ liệu nhân viên theo đúng cột hướng dẫn trong file.</p>
                </div>
              </div>
              <div class="step">
                <span class="step-index">3</span>
                <div class="step-content">
                  <p>Chọn file Excel để import:</p>
                  <div class="upload-box" [class.loading]="importLoading">
                    <input type="file" accept=".xlsx,.xls" (change)="onFileSelected($event)" [disabled]="importLoading" />
                    <div class="file-info" *ngIf="importFile">
                      <i class="icon-file"></i> {{ importFile.name }}
                      <button type="button" class="clear-file" (click)="importFile=null" [disabled]="importLoading">×</button>
                    </div>
                    <div class="placeholder" *ngIf="!importFile">Kéo thả hoặc chọn file .xlsx / .xls</div>
                  </div>
                </div>
              </div>
              <div class="import-hint">
                <small><strong>Lưu ý:</strong> Các hàng trống sẽ bị bỏ qua. Vui lòng kiểm tra định dạng ngày (dd/MM/yyyy).</small>
              </div>

              <!-- Import Result Summary -->
              <div class="import-result" *ngIf="importResult">
                <div class="result-summary" [class.has-errors]="importResult.failedCount > 0">
                  <div class="summary-item success">
                    <i class="icon-check-circle"></i>
                    <span>{{ importResult.successCount }} thành công</span>
                  </div>
                  <div class="summary-item error" *ngIf="importResult.failedCount > 0">
                    <i class="icon-alert-circle"></i>
                    <span>{{ importResult.failedCount }} thất bại</span>
                  </div>
                  <div class="summary-item total">
                    <span>Tổng: {{ importResult.totalRows }} dòng</span>
                  </div>
                </div>

                <!-- Error Details Table -->
                <div class="error-details" *ngIf="importResult.errors && importResult.errors.length > 0">
                  <h4><i class="icon-alert-circle"></i> Chi tiết lỗi</h4>
                  <div class="error-table-wrapper">
                    <table class="error-table">
                      <thead>
                        <tr>
                          <th>Dòng</th>
                          <th>Lỗi</th>
                          <th>Dữ liệu</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let err of importResult.errors">
                          <td class="row-number">{{ err.row }}</td>
                          <td class="error-message">{{ err.error }}</td>
                          <td class="error-data">{{ err.data }}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="error-actions">
                    <small>💡 Vui lòng sửa các lỗi trên và thử import lại.</small>
                  </div>
                </div>
              </div>

              <div class="loading-overlay" *ngIf="importLoading">
                <div class="spinner"></div>
                <p>Đang import dữ liệu...</p>
              </div>
            </div>
          </ng-container>

          <!-- Confirmation -->
          <ng-container *ngSwitchCase="'toggle-status'">
            <div class="confirmation-content">
              <div class="confirmation-icon" [class]="toggleStatusEmployee?.isDeleted ? 'restore' : 'deactivate'">
                <i [class]="toggleStatusEmployee?.isDeleted ? 'icon-user-check' : 'icon-user-x'"></i>
              </div>
              <div class="confirmation-text">
                <p *ngIf="toggleStatusEmployee?.isDeleted">
                  Bạn có chắc muốn <strong>khôi phục</strong> nhân viên 
                  <strong>{{ toggleStatusEmployee?.ten }}</strong> về trạng thái còn làm việc không?
                </p>
                <p *ngIf="!toggleStatusEmployee?.isDeleted">
                  Bạn có chắc muốn chuyển nhân viên 
                  <strong>{{ toggleStatusEmployee?.ten }}</strong> sang trạng thái <strong>nghỉ việc</strong> không?
                </p>
                <small>Thao tác này có thể hoàn tác được.</small>
              </div>
            </div>
          </ng-container>

          <ng-container *ngSwitchCase="'contract-history'">
            <div class="contract-history-wrapper">
              <div class="loading-wrapper" *ngIf="contractHistoryLoading">
                <div class="loading-spinner"></div>
                <p>Đang tải lịch sử hợp đồng...</p>
              </div>

              <div class="contract-history-list" *ngIf="!contractHistoryLoading">
                <div class="empty-state" *ngIf="contractHistory.length === 0">
                  <i class="icon-file-text"></i>
                  <p>Chưa có lịch sử thay đổi hợp đồng</p>
                </div>

                <div class="timeline" *ngIf="contractHistory.length > 0">
                  <div class="timeline-item" *ngFor="let history of contractHistory; let i = index">
                    <div class="timeline-marker">
                      <div class="timeline-dot"></div>
                      <div class="timeline-line" *ngIf="i < contractHistory.length - 1"></div>
                    </div>
                    <div class="timeline-content">
                      <div class="timeline-header">
                        <div class="timeline-date">
                          <i class="icon-calendar"></i>
                          {{ history.ngayThayDoi | vnDate:'dd/MM/yyyy HH:mm' }}
                        </div>
                        <div class="timeline-badge">
                          {{ formatContractType(history.loaiHopDong) }}
                        </div>
                      </div>
                      <div class="timeline-body">
                        <div class="contract-info">
                          <div class="contract-detail">
                            <span class="label">Loại hợp đồng:</span>
                            <span class="value">{{ formatContractType(history.loaiHopDong) }}</span>
                          </div>
                          <div class="contract-detail">
                            <span class="label">Số tháng:</span>
                            <span class="value">{{ history.soThangHopDong === 999 ? 'Vô thời hạn' : history.soThangHopDong + ' tháng' }}</span>
                          </div>
                        </div>
                        <div class="contract-change" *ngIf="history.ghiChu">
                          <i class="icon-arrow-right"></i>
                          <span>{{ formatContractNote(history.ghiChu) }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </ng-container>
      </div>
      
      <div class="modal-actions" *ngIf="popupType !== 'import-excel' && popupType !== 'contract-history'">
        <button class="btn btn-outline" (click)="closePopup()">
          <i class="icon-x"></i>
          Hủy bỏ
        </button>
        <button *ngIf="popupType === 'add'" class="btn btn-primary" (click)="addEmployee()">
          <i class="icon-plus"></i>
          Thêm nhân viên
        </button>
        <button *ngIf="popupType === 'edit'" class="btn btn-primary" (click)="saveEdit()">
          <i class="icon-save"></i>
          Lưu thay đổi
        </button>
        <button *ngIf="popupType === 'toggle-status'" 
                class="btn" 
                [class.btn-success]="toggleStatusEmployee?.isDeleted"
                [class.btn-warning]="!toggleStatusEmployee?.isDeleted"
                (click)="toggleEmployeeStatus()">
          <i [class]="toggleStatusEmployee?.isDeleted ? 'icon-user-check' : 'icon-user-x'"></i>
          {{ toggleStatusEmployee?.isDeleted ? 'Khôi phục' : 'Nghỉ việc' }}
        </button>
      </div>

      <div class="modal-actions" *ngIf="popupType === 'contract-history'">
        <button class="btn btn-outline" (click)="closePopup()">
          <i class="icon-x"></i>
          Đóng
        </button>
      </div>

      <!-- Import Excel Actions -->
      <div class="modal-actions import-excel-actions" *ngIf="popupType === 'import-excel'">
        <button class="btn btn-outline" (click)="closePopup()" [disabled]="importLoading">
          <i class="icon-x"></i>
          {{ importResult ? 'Đóng' : 'Hủy' }}
        </button>
        <button class="btn btn-primary" (click)="importExcel()" [disabled]="importLoading || !importFile" *ngIf="!importResult">
          <i class="icon-upload"></i>
          <span *ngIf="!importLoading">Import ngay</span>
          <span *ngIf="importLoading">Đang xử lý...</span>
        </button>
        <button class="btn btn-success" (click)="importResult = null; importFile = null" *ngIf="importResult && importResult.failedCount > 0">
          <i class="icon-refresh"></i>
          Thử lại
        </button>
      </div>
    </div>
  </div>
</div>